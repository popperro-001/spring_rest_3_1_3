
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- JQuery connect-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <link href="/css/main.css" rel="stylesheet"/>

    <title>Admin panel</title>
</head>
<body>

<!--Users Table-->
<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th>ID</th>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="data"></tbody>
</table>
<!--Users Table End-->
<!--Edit User-->
<div id="editUserModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="editUserForm">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Employee</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>ID</label>
                        <input type="text" id="edit-id" disabled="disabled"
                               class="form-control" required />
                    </div>
                    <label>Username</label>
                    <input type="text" id="edit-username" placeholder="Enter Username"
                           class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="text" id="edit-password" placeholder="Enter Password"
                           class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="text" id="edit-email" placeholder="Enter Email"
                           class="form-control" required />
                </div>
                <select multiple size="2" class="form-control" id="edit-role">
                    <option th:each="role : ${roles}"
                            th:text="${role.getName()}"
                            th:value="${role.getId()}"></option>
                </select>
                <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-info" value="Save">
                </div>
            </form>
        </div>
    </div>
</div>
<!--Edit User End-->





<script>
    const allUsers = document.getElementById('data')

    const renderUsers = (all) =>{
                    console.log(all);
                    if (all.length>0){
                        let temp = "";

                        //--start loop
                        all.forEach((u)=>{
                            temp +="<tr>";
                            temp +="<td>"+u.id+"</td>";
                            temp +="<td>"+u.username+"</td>";
                            temp +="<td>"+u.email+"</td>";
                            temp +="<td>";
                            u.roles.forEach((r)=>{
                                temp += r.name + " ";
                            })
                            temp +="</td>";
                            temp +="<td>";
                            temp +="<td><span style='display: inline'>"
                            temp += '<a href="http://localhost:8080/api/users/' + u.id + '" class="btn btn-info eBtn" data-toggle="modal" data-target="#editModal">'
                                + 'Edit</a>';
                            temp +="" + '<a href="http://localhost:8080/api/users/'+u.id+'" class="btn btn-danger dBtn" data-toggle="modal" data-target="#deleteModal">' + 'Delete</a></span></td>';
                            temp +="</tr>";
                        })
                        //--end loop
                        allUsers.innerHTML=temp;
                    }
                }

function show(){
        fetch("http://localhost:8080/api/users")
            .then(res=>res.json())
            .then(data=>renderUsers(data))
}
window.onload = show();


</script>
<script>

</script>
</body>
</html>